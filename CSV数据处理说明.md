# CSV数据处理说明文档

## 概述

`process_csv_data.py` 脚本用于处理上海和天津的CSV格式房价数据，将其转换为与项目统一的数据格式。

## 功能特性

1. **数据格式转换**：将原始CSV数据转换为统一格式
2. **时间筛选**：筛选2023-2025年的数据
3. **数据清洗**：自动删除缺失关键字段的记录
4. **统计分析**：提供详细的数据统计信息

## 数据字段映射

### 输入格式（原始CSV）
- `community` → 小区
- `district` → 区域
- `business_area` → 商圈
- `room_type` → 户型
- `area` → 面积（m²）
- `total_price` → 成交价（万元）
- `unit_price` → 成交单价（元）
- `deal_date` → 成交日期

### 输出格式（统一格式）
- 成交日期
- 城市
- 区域
- 商圈
- 小区
- 户型
- 面积（m²）
- 挂牌价（万元）*注：CSV数据中无此字段，设为空*
- 成交价（万元）
- 成交单价（元）

## 使用方法

### 方式一：直接运行脚本

```bash
# 激活虚拟环境
source venv/bin/activate

# 运行脚本（处理上海和天津数据）
python3 process_csv_data.py
```

### 方式二：作为模块导入

```python
from process_csv_data import process_csv_city_data

# 处理单个城市数据
process_csv_city_data(
    csv_file='data/raw/上海市.csv',
    city_name='上海',
    output_file='data/processed/data_shanghai_2023_2025.csv',
    start_year=2023,
    end_year=2025
)
```

## 处理结果

### 上海数据统计（2023-2025）
- **成交量**：2,132 套
- **平均成交价**：371.19 万元
- **中位数成交价**：316.00 万元
- **平均单价**：55,612.60 元/m²
- **平均面积**：68.49 m²
- **价格范围**：22.00 - 2,750.00 万元

**年度成交量分布**：
- 2023年：696 套
- 2024年：861 套
- 2025年：575 套

**主要区域**（按成交量）：
1. 浦东：713 套（均价 66,604 元/m²）
2. 松江：502 套（均价 37,244 元/m²）
3. 普陀：478 套（均价 53,336 元/m²）
4. 杨浦：169 套（均价 55,354 元/m²）
5. 徐汇：165 套（均价 77,998 元/m²）
6. 青浦：105 套（均价 44,396 元/m²）

### 天津数据统计（2023-2025）
- **成交量**：213,983 套
- **平均成交价**：123.98 万元
- **中位数成交价**：102.00 万元
- **平均单价**：15,664.63 元/m²
- **平均面积**：84.58 m²
- **价格范围**：4.00 - 2,300.00 万元

**年度成交量分布**：
- 2023年：63,834 套
- 2024年：77,150 套
- 2025年：72,999 套

**主要区域**（按成交量）：
1. 武清：32,464 套（均价 10,627 元/m²）
2. 津南：24,131 套（均价 9,975 元/m²）
3. 河西：23,411 套（均价 30,183 元/m²）
4. 西青：20,900 套（均价 13,650 元/m²）
5. 河东：18,979 套（均价 16,869 元/m²）
6. 红桥：16,561 套（均价 12,504 元/m²）
7. 南开：15,074 套（均价 26,075 元/m²）
8. 滨海新区：13,598 套（均价 10,439 元/m²）
9. 东丽：13,501 套（均价 11,012 元/m²）
10. 北辰：11,264 套（均价 11,133 元/m²）

## 输出文件

处理后的数据保存在 `data/processed/` 目录下：
- `data_shanghai_2023_2025.csv` - 上海数据
- `data_tianjin_2023_2025.csv` - 天津数据

## 注意事项

1. **日期格式**：脚本自动处理多种日期格式
2. **数据清洗**：自动删除成交日期、成交价、面积、单价为空的记录
3. **单价处理**：自动清理单价字段中的"元"字符和其他非数字字符
4. **编码格式**：输出文件使用UTF-8-BOM编码，Excel可直接打开

## 与其他处理脚本的关系

- `process_data.py`：处理Excel格式数据（北京、武汉、厦门）
- `process_csv_data.py`：处理CSV格式数据（上海、天津）

两个脚本输出的数据格式完全一致，可以在项目中统一使用。

## 故障排除

### 问题1：日期解析错误
**解决方案**：脚本已使用 `format='mixed'` 参数，可自动处理多种日期格式

### 问题2：编码问题
**解决方案**：脚本使用 `utf-8-sig` 编码保存，确保中文正确显示

### 问题3：缺少pandas模块
**解决方案**：确保已激活虚拟环境
```bash
source venv/bin/activate
```

---

**创建日期**：2025-12-15  
**版本**：1.0

