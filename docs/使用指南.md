# 房价数据分析系统 - 使用指南

## 🚀 快速启动

### 方式一：使用启动脚本（推荐）

```bash
./start.sh
```

### 方式二：手动启动

```bash
# 1. 激活虚拟环境
source venv/bin/activate

# 2. 启动应用
python app.py
```

启动后，在浏览器中访问：**http://localhost:5001**

---

## 📥 如何添加新城市数据？

### 场景1：有 Excel 文件（推荐流程）

假设你有一个 `深圳成交数据.xlsx` 文件：

**步骤1：修改数据处理脚本**

编辑 `process_data.py`，在 `cities` 列表中添加：

```python
cities = [
    # ... 现有城市 ...
    {
        'name': '深圳',
        'excel_file': '深圳成交数据.xlsx',
        'output_file': 'data_shenzhen_2023_2025.csv'
    }
]
```

**步骤2：运行数据处理**

```bash
source venv/bin/activate
python process_data.py
```

**步骤3：更新配置文件**

编辑 `config.json`，添加：

```json
{
  "name": "深圳",
  "name_en": "shenzhen",
  "data_file": "data_shenzhen_2023_2025.csv",
  "enabled": true
}
```

**步骤4：重新加载**

- 方式1：在网页上点击 "🔄 重新加载配置" 按钮
- 方式2：重启服务器（Ctrl+C 停止，然后重新运行 `./start.sh`）

### 场景2：已有 CSV 文件

如果你已经有处理好的 CSV 文件：

**步骤1：确认 CSV 格式**

确保包含以下列：
- 成交日期、城市、区域、商圈、小区
- 户型、面积（m²）、挂牌价（万元）
- 成交价（万元）、成交单价（元）

**步骤2：放入项目目录**

将 CSV 文件复制到项目根目录

**步骤3：更新 config.json**

```json
{
  "name": "广州",
  "name_en": "guangzhou",
  "data_file": "data_guangzhou_2023_2025.csv",
  "enabled": true
}
```

**步骤4：刷新网页**

点击网页上的 "🔄 重新加载配置" 按钮

---

## 📊 Excel 数据格式要求

你的 Excel 文件应该包含以下列（列名必须完全一致）：

| 列名 | 说明 | 示例 |
|------|------|------|
| 成交日期 | 格式：YYYY.MM.DD | 2023.01.15 |
| 城市 | 城市名称 | 北京 |
| 区域 | 行政区域 | 朝阳 |
| 商圈 | 商圈名称 | 国贸 |
| 小区 | 小区名称 | 建外SOHO |
| 户型 | 房间配置 | 3室2厅 |
| 朝向 | 房屋朝向 | 南 |
| 楼层 | 楼层信息 | 高楼层 |
| 面积（m²） | 建筑面积 | 120.5 |
| 挂牌价（万元） | 原挂牌价 | 800 |
| 成交价（万元） | 实际成交价 | 750 |
| 成交单价（元） | 每平米单价 | 62241 |
| 成交周期 | 天数 | 45天 |
| 网页链接 | 来源链接 | https://... |

**注意**：
- 系统会自动保留必要的列，删除 `朝向`、`楼层`、`成交周期`、`网页链接` 等列
- 筛选 2023-2025 年的数据
- 删除有缺失值的记录

---

## 🔧 配置文件说明

### config.json 完整示例

```json
{
  "cities": [
    {
      "name": "北京",              // 中文名称（显示在网页上）
      "name_en": "beijing",        // 英文标识（用于API，必须唯一）
      "data_file": "data_beijing_2023_2025.csv",  // CSV文件路径
      "enabled": true              // 是否启用
    },
    {
      "name": "厦门",
      "name_en": "xiamen",
      "data_file": "data_xiamen_2023_2025.csv",
      "enabled": true
    }
  ],
  "data_directory": ".",           // 数据文件目录（.表示当前目录）
  "year_range": {
    "start": 2023,                 // 分析起始年份
    "end": 2025                    // 分析结束年份
  }
}
```

### 字段说明

- **name**: 城市的中文名称，显示在网页按钮和标题上
- **name_en**: 城市的英文标识，用于API路径，必须：
  - 全小写字母
  - 不包含特殊字符
  - 在所有城市中唯一
- **data_file**: CSV数据文件的路径（相对于 `data_directory`）
- **enabled**: 
  - `true`: 该城市数据会显示在网页上
  - `false`: 临时禁用该城市（不会显示）

---

## 🛠️ 常用操作

### 临时禁用某个城市

编辑 `config.json`，将对应城市的 `enabled` 改为 `false`：

```json
{
  "name": "武汉",
  "name_en": "wuhan",
  "data_file": "data_wuhan_2023_2025.csv",
  "enabled": false   // 禁用
}
```

### 修改分析年份范围

1. 修改 `config.json` 中的 `year_range`
2. 重新运行 `python process_data.py` 处理数据
3. 重启服务器

### 更新数据

如果原始 Excel 文件有更新：

```bash
# 1. 替换 Excel 文件
# 2. 重新处理数据
python process_data.py

# 3. 重启服务器
./start.sh
```

---

## ❓ 常见问题

### Q1: 数据加载失败？

**检查清单**：
1. CSV 文件是否存在？
2. `config.json` 中的文件路径是否正确？
3. CSV 文件编码是否为 UTF-8？
4. 是否包含必需的列？

**解决方法**：
```bash
# 重新处理数据
python process_data.py

# 检查文件是否生成
ls -lh data_*.csv
```

### Q2: 网页显示不正常？

1. 清除浏览器缓存（Ctrl+Shift+R 或 Cmd+Shift+R）
2. 检查浏览器控制台是否有错误
3. 确认服务器是否正常运行

### Q3: 如何更换端口？

编辑 `app.py` 最后一行：

```python
app.run(debug=True, host='0.0.0.0', port=5001)  # 改为其他端口
```

### Q4: 数据处理脚本报错？

常见原因：
- Excel 文件不存在或路径错误
- Excel 文件格式不正确
- 列名不匹配

**调试方法**：
```bash
# 查看详细错误信息
python process_data.py
```

### Q5: 如何在服务器上部署？

**生产环境部署建议**：

1. 使用 gunicorn：
```bash
pip install gunicorn
gunicorn -w 4 -b 0.0.0.0:5001 app:app
```

2. 使用 nginx 作为反向代理

3. 关闭 debug 模式：
```python
app.run(debug=False, host='0.0.0.0', port=5001)
```

---

## 📞 技术支持

遇到问题？检查以下内容：

1. **服务器日志**：查看终端输出的错误信息
2. **浏览器控制台**：F12 打开开发者工具，查看 Console 和 Network 标签
3. **数据文件**：确认所有 CSV 文件格式正确

---

## 📈 功能扩展建议

### 可以考虑添加的功能：

1. **数据导出**：导出分析报告为 PDF/Excel
2. **对比分析**：多城市横向对比
3. **预测功能**：基于历史数据预测未来趋势
4. **用户筛选**：按区域、价格区间筛选
5. **地图可视化**：在地图上显示房价分布

### 扩展开发提示：

- 后端 API 在 `app.py` 中扩展
- 前端页面在 `templates/index.html` 修改
- 样式在 `static/css/style.css` 调整
- JavaScript 逻辑在 `static/js/main.js` 添加

---

**最后更新**：2025年11月27日

